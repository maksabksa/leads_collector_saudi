# منصة تحليل التسويق الرقمي - Leads Collector Saudi

## قاعدة البيانات والـ Backend
- [x] تصميم schema: جداول leads, zones, website_analyses, social_analyses
- [x] تطبيق migration SQL
- [x] كتابة DB helpers في server/db.ts
- [x] إنشاء tRPC routers: leads, zones, analysis, export

## واجهة المستخدم
- [x] تصميم CSS variables والثيم الاحترافي (dark elegant) مع خط IBM Plex Arabic
- [x] بناء Layout مع sidebar عربي RTL
- [x] صفحة لوحة التحكم الرئيسية (Dashboard) مع إحصائيات وتقدم الهدف
- [x] صفحة إدارة المناطق الجغرافية (Zones) - 22 منطقة تلقائية
- [x] صفحة قائمة Leads مع فلترة وبحث وتصدير
- [x] نموذج إدخال Lead جديد (Add Lead Form) مع تحقق
- [x] صفحة تفاصيل Lead مع التحليلات الكاملة

## محللات التسويق الرقمي
- [x] محلل المواقع الإلكترونية (Website Analyzer) مع LLM
- [x] محلل السوشيال ميديا (Social Media Analyzer) مع LLM
- [x] نظام تقييم الثغرات التسويقية
- [x] توليد زاوية الدخول البيعية (Sales Entry Angle)
- [x] تقرير شامل بالذكاء الاصطناعي (Full Report)

## التقارير والتصدير
- [x] تقرير تفصيلي لكل Lead
- [x] تصدير CSV مع فلترة
- [ ] تصدير Excel (مستقبلي)
- [ ] تصدير PDF (مستقبلي)

## الاختبارات
- [x] Vitest tests للـ routers الرئيسية (6 اختبارات تمر)
- [x] التحقق من صحة البيانات في النماذج

## نظام البحث اليدوي التفاعلي (جديد)
- [x] صفحة البحث: حقل نوع النشاط + المدينة + زر بحث
- [x] Backend: Google Places Text Search API proxy في tRPC
- [x] Backend: Google Places Details API لجلب الهاتف والموقع والتفاصيل
- [x] عرض نتائج البحث في بطاقات مع الاسم والهاتف والعنوان والتقييم
- [x] زر "أضف كـ Lead" في كل بطاقة نتيجة مع إضافة فورية للقاعدة
- [x] منع التكرار: تنبيه إذا كان العميل موجود مسبقاً
- [x] إضافة صفحة البحث للـ sidebar

## المتصفح المدمج (Browser Scout)
- [ ] صفحة متصفح مدمج مع iframe وشريط عناوين قابل للتعديل
- [ ] اختصارات سريعة للمنصات (إنستغرام، سناب شات، تيك توك، Google Maps، LinkedIn)
- [ ] لوحة جانبية لاستخراج البيانات يدوياً (اسم، هاتف، نوع النشاط، روابط)
- [ ] زر "أضف كـ Lead" من اللوحة الجانبية مباشرة
- [ ] إضافة الصفحة للـ sidebar بأيقونة متصفح

## التحسينات الجديدة (الدفعة الثانية)
- [x] فلتر مصدر البحث في صفحة البحث (إنستغرام، فيسبوك، تيليغرام، Google Maps، الكل)
- [x] روابط مباشرة تفتح المنصة المختارة بكلمة البحث تلقائياً
- [x] صفحة Browser Scout مع نموذج استخراج بيانات يدوي
- [x] حفظ تلقائي (auto-save) بعد 2.5 ثانية من توقف الكتابة بدون زر
- [x] تحليل مباشر مدمج في صفحة بيانات العميل (LeadDetail)
- [x] تحديث تصدير CSV: كل بيانات العميل + تحليل الموقع + تحليل سوشيال في صف واحد

## التطوير الشامل - الدفعة الثالثة

### فلتر الدول والمدن
- [x] إضافة حقل country للـ leads في قاعدة البيانات
- [x] قاموس شامل: 10+ دول عربية مع مدنها الرئيسية (shared/countries.ts)
- [x] فلتر الدولة → يحدث قائمة المدن تلقائياً في جميع الصفحات
- [x] تحديث صفحة Leads بفلتر الدولة والمدينة
- [x] تحديث صفحة AddLead بفلتر الدولة والمدينة
- [ ] تحديث صفحة Search بفلتر الدولة والمدينة
- [ ] تحديث Dashboard بإحصائيات حسب الدولة

### محرك البحث الذكي في الخلفية
- [x] جدول search_jobs في قاعدة البيانات (المهمة، الحالة، التقدم، النتائج)
- [x] tRPC router لإدارة مهام البحث (إنشاء، متابعة، إيقاف)
- [x] خوارزمية البحث المنهجي: تقسيم المدينة لمناطق + بحث متعدد الكلمات
- [x] منع التكرار: فحص رقم الهاتف والاسم قبل الإضافة
- [x] تأخير بشري عشوائي بين الطلبات (2-5 ثوانٍ)
- [x] صفحة "محرك البحث" مع واجهة إنشاء مهام وتتبع حي
- [x] مؤشر تقدم حي مع عداد النتائج المكتشفة
- [x] إشعار عند اكتمال المهمة

## محرك البحث متعدد المنصات - الدفعة الرابعة
- [x] خيار Google Maps: بحث تلقائي كامل عبر Places API
- [x] خيار سناب شات: يفتح بحث سناب + نموذج استخراج يدوي
- [x] خيار إنستغرام: يفتح بحث إنستغرام + نموذج استخراج يدوي
- [x] خيار تيك توك: يفتح بحث تيك توك + نموذج استخراج يدوي
- [x] خيار فيسبوك: يفتح بحث فيسبوك + نموذج استخراج يدوي
- [x] خيار معروف.sa: يفتح معروف مع الكلمة المفتاحية + نموذج استخراج يدوي
- [x] خيار الكل: يشغّل Google Maps تلقائياً + يفتح باقي المنصات في تبويبات
- [x] واجهة موحدة: اختيار المنصة يغير طريقة العمل (تلقائي vs يدوي)
- [x] مؤشر واضح: "تلقائي كامل" أو "يدوي مساعد" لكل منصة

## الدفعة الخامسة - تحسينات جوهرية
- [x] تغيير اسم التطبيق إلى "بحثي - مجمع البيانات"
- [x] رفع حد الـ Leads إلى ما لا نهاية (إزالة الحد 400)
- [x] تحديث لوحة التحكم لعرض التقدم بدون حد (∞)
- [x] دمج AI في البحث اليدوي: توليد استراتيجية بحث ذكية لكل منصة ونشاط
- [x] AI يقترح hashtags وكلمات بحث مخصصة لكل نشاط ومنصة
- [x] AI يحلل البيانات المدخلة يدوياً ويقيّم جودة العميل (1-10)
- [x] AI يقترح زاوية التواصل المثلى بناءً على نوع النشاط والمنصة

## الدفعة السادسة - تاريخ السوشيال + تحليل تلقائي
- [x] إضافة حقل socialSince (تاريخ الظهور على السوشيال) في schema
- [x] migration لإضافة العمود الجديد
- [x] تحديث DB helpers لدعم socialSince
- [x] تحديث leads.create ليُشغّل التحليل تلقائياً بعد الحفظ (setImmediate)
- [x] تحديث صفحة AddLead بحقل socialSince
- [x] تحديث صفحة LeadDetail لعرض socialSince
- [x] تحديث صفحة Leads لعرض socialSince في الجدول

## الدفعة السابعة - نظام واتساب المتكامل

- [ ] إضافة حقل hasWhatsapp + whatsappCheckedAt في جدول leads
- [ ] إضافة جدول whatsapp_messages لتتبع الرسائل المرسلة
- [ ] migration لإضافة الحقول والجدول الجديد
- [ ] tRPC router: checkWhatsapp (فحص وجود واتساب عبر wa.me)
- [ ] tRPC router: generateWhatsappMessage (AI يولد رسالة مخصصة)
- [ ] tRPC router: logWhatsappMessage (تسجيل الرسالة المرسلة)
- [ ] tRPC router: bulkWhatsapp (إرسال مجمع لقائمة عملاء)
- [ ] زر فحص واتساب في LeadDetail مع مؤشر ✅/❌
- [ ] زر "إرسال واتساب" يفتح wa.me مع الرسالة المولّدة بالـ AI
- [ ] صفحة الإرسال المجمع في Leads: اختيار عملاء + توليد رسائل + إرسال
- [ ] عرض حالة واتساب في جدول Leads (أيقونة ملونة)
